@inject NavigationManager navigationManager
@inject VestaService ventaService
@inject SucursalService sucursalService
@inject DirectorService directorService
<h2>@titulo</h2>
<EditForm Model="oVenta" OnValidSubmit="@guardar">
    <DataAnnotationsValidator />


    <div class="mt-3">
        <label>Numero Empleados</label>
        <InputNumber readonly class="form-control" @bind-Value="oVenta.numeroEmpleados" />
        <ValidationMessage For="@(() => oVenta.numeroEmpleados)" />
    </div>

    <div class="mt-3">
        <label>Nombre</label>
        <InputText class="form-control" @bind-Value="oVenta.nombre" />
        <ValidationMessage For="@(() => oVenta.nombre)" />
    </div>

    <div class="mt-3">
        <label>Cargo</label>
        <InputText class="form-control" @bind-Value="oVenta.cargo" />
        <ValidationMessage For="@(() => oVenta.cargo)" />
    </div>

    <div class="mt-3">
        <label>Fecha de Contrato</label>
        <InputDate class="form-control" @bind-Value="oVenta.fechaContrato" />
        <ValidationMessage For="@(() => oVenta.fechaContrato)" />
    </div>

    <div class="mt-3">
        <label>Cuota</label>
        <InputNumber class="form-control" @bind-Value="oVenta.cuota" />
        <ValidationMessage For="@(() => oVenta.cuota)" />
    </div>

    <div class="mt-3">
        <label>Venta</label>
        <InputNumber class="form-control" @bind-Value="oVenta.venta" />
        <ValidationMessage For="@(() => oVenta.venta)" />
    </div>
    <div class="mt-3">
        <label>Seleccione Sucursal</label>
        <InputSelect class="form-control" @bind-Value="oVenta.idSucursal">
            <option value="0">--Seleccione--</option>
            @foreach (var item in listaSucursal)
            {
                <option value="@item.idSucursal">@item.nombreSucursal</option>
            }
        </InputSelect>
        <ValidationMessage For="@(() => oVenta.idSucursal)" />
    </div>
    <div class="mt-3">
        <label>Seleccione Director</label>
        <InputSelect class="form-control" @bind-Value="oVenta.idDirector">
            <option value="0">--Seleccione--</option>
            @foreach (var item in listaDirector)
            {
                <option value="@item.idDirector">@item.nombreDirector</option>
            }
        </InputSelect>
        <ValidationMessage For="@(() => oVenta.idDirector)" />
    </div>
    <div class="mt-3">

        <button type="submit" class="btn btn-success">GUARDAR</button>

        <button type="button" class="btn btn-danger" @onclick="Regresar">REGRESAR</button>
    </div>
</EditForm>
@code {
    public Class1 oVenta { get; set; } = new Class1();

    [Parameter]
    public int idVenta { get; set; }

    public string titulo { get; set; } = "";
    public List<Sucursal> listaSucursal { get; set; } = new List<Sucursal>();
    public List<Director> listaDirector { get; set; } = new List<Director>();

    private void guardar()
    {
        if (titulo == "Agregar Venta")
        {
            ventaService.guardarVenta(oVenta);
            navigationManager.NavigateTo("/formventa");
        }
        else
        {
            ventaService.editarVenta(oVenta);
            navigationManager.NavigateTo("/formventa");
        }
    }

    private void Regresar()
    {
        navigationManager.NavigateTo("/formventa");
    }

    protected override Task OnInitializedAsync()
    {
        listaSucursal = sucursalService.listarSucursales();
        listaDirector = directorService.listarDirecores();
        if (idVenta == 0)
        {
            titulo = "Agregar Venta";
        }
        else
        {
            titulo = "Editar Venta";
            oVenta = ventaService.ResuperarIdVenta(idVenta);
        }

        return base.OnInitializedAsync();
    }


}